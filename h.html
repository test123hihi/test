<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LinkVerse - Giao Diện Hoạt Hình</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      /* --- Playful Cartoon Theme --- */
      :root {
        --primary-bg: #fdf6e3; /* Soft cream */
        --secondary-bg: #fefefe;
        --outline-color: #586e75; /* Soft dark grey/blue for outlines */
        --text-dark: #586e75;
        --text-medium: #657b83;
        --text-light: #93a1a1;
        --accent-teal: #2aa198;
        --accent-red: #dc322f;
        --accent-green: #859900;
        --accent-yellow: #b58900;
        --radius-default: 12px;
        --radius-lg: 16px;
        --transition-bouncy: 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      }

      /* Base Styles */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      @keyframes bob {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-3px);
        }
      }

      body {
        font-family: "Nunito", sans-serif;
        font-weight: 600;
        background-color: var(--primary-bg);
        color: var(--text-dark);
        line-height: 1.5;
      }

      h2,
      h3 {
        font-weight: 800;
      }

      /* Header */
      header {
        background-color: var(--secondary-bg);
        padding: 16px 40px;
        border-bottom: 3px solid var(--outline-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        z-index: 100;
      }

      header .logo {
        font-size: 2.2em;
        font-weight: 800;
        animation: bob 3s ease-in-out infinite;
      }
      header .logo .fas {
        color: var(--accent-teal);
      }

      /* Shared Styles for bordered elements */
      .bordered-element {
        background-color: var(--secondary-bg);
        border: 3px solid var(--outline-color);
        border-radius: var(--radius-default);
        transition: all var(--transition-bouncy);
        box-shadow: 5px 5px 0 0 var(--outline-color);
      }
      .bordered-element:hover {
        box-shadow: 7px 7px 0 0 var(--outline-color);
        transform: translate(-2px, -2px);
      }
      .bordered-element:active {
        box-shadow: 2px 2px 0 0 var(--outline-color);
        transform: translate(3px, 3px);
      }

      input,
      select {
        width: 100%;
        padding: 12px 16px;
        font-size: 1em;
        font-family: "Nunito", sans-serif;
        font-weight: 600;
      }

      input:focus,
      select:focus {
        outline: none;
        box-shadow: 0 0 0 3px var(--accent-yellow);
      }

      /* Main Layout */
      main {
        display: flex;
        padding: 32px;
        gap: 32px;
      }

      /* Sidebar */
      .sidebar {
        width: 300px;
        flex-shrink: 0;
        align-self: flex-start;
        position: sticky;
        top: 105px;
      }
      .sidebar-content {
        padding: 24px;
      }

      #folderList li {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 16px;
        cursor: pointer;
        border-radius: var(--radius-default);
        margin-bottom: 8px;
        transition: all var(--transition-bouncy);
      }
      #folderList li:hover {
        background-color: var(--secondary-bg);
        transform: translateX(5px);
      }
      #folderList li.active {
        background-color: var(--secondary-bg);
        font-weight: 800;
        color: var(--accent-teal);
        border: 2px solid var(--outline-color);
      }
      #folderList li .delete-folder-btn {
        opacity: 0;
        visibility: hidden;
        background: none;
        border: none;
        cursor: pointer;
        font-size: 1.1em;
        color: var(--text-light);
        transition: all 0.2s ease;
      }
      #folderList li:hover .delete-folder-btn {
        opacity: 1;
        visibility: visible;
      }
      #folderList li .delete-folder-btn:hover {
        color: var(--accent-red);
        transform: scale(1.3);
      }

      .action-button {
        width: 100%;
        padding: 12px 20px;
        cursor: pointer;
        font-size: 1.1em;
        font-weight: 800;
        font-family: "Nunito", sans-serif;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        color: white;
      }
      #addFolderBtn {
        background-color: var(--accent-teal);
      }
      #toggleAddLinkForm {
        background-color: var(--accent-green);
      }

      /* Link Management & Cards */
      .link-management {
        flex-grow: 1;
      }

      #addLinkFormContainer {
        margin-bottom: 32px;
        padding: 32px;
      }

      .link-list-container {
        padding: 32px;
      }

      .link-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 32px;
      }

      .link-card {
        padding: 24px;
        display: flex;
        flex-direction: column;
      }

      .link-card .tag {
        background-color: var(--primary-bg);
        border: 2px solid var(--outline-color);
        color: var(--text-medium);
        padding: 4px 12px;
        border-radius: 999px;
        font-size: 0.8em;
        font-weight: 700;
        cursor: pointer;
        transition: all var(--transition-bouncy);
      }
      .link-card .tag:hover {
        transform: scale(1.1);
        background-color: var(--accent-yellow);
        color: white;
      }
      .link-card .actions button {
        background: none;
        border: none;
        font-size: 1.2em;
        cursor: pointer;
        color: var(--text-light);
        transition: all var(--transition-bouncy);
      }
      .link-card .actions button:hover {
        transform: scale(1.3);
      }
      .link-card .actions button.edit-btn:hover {
        color: var(--accent-teal);
      }
      .link-card .actions button.tag-btn:hover {
        color: var(--accent-yellow);
      }
      .link-card .actions button.delete-btn:hover {
        color: var(--accent-red);
      }

      /* Modal */
      .modal {
        display: none;
        position: fixed;
        z-index: 2000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(88, 110, 117, 0.6);
        backdrop-filter: blur(4px);
        justify-content: center;
        align-items: center;
      }
      .modal.active {
        display: flex;
      }
      .modal-content {
        padding: 32px;
        width: 90%;
        max-width: 500px;
        position: relative;
      }
      #modalConfirm,
      #modalCancel {
        border-radius: var(--radius-default);
        color: white;
        padding: 10px 24px;
      }
      #modalConfirm {
        background-color: var(--accent-red);
      }
      #modalCancel {
        background-color: var(--text-light);
      }

      /* Responsive adjustments */
      @media (max-width: 992px) {
        main {
          flex-direction: column;
        }
        .sidebar {
          width: 100%;
          position: static;
        }
      }
      @media (max-width: 768px) {
        header {
          flex-direction: column;
          align-items: stretch;
          gap: 1rem;
        }
        main {
          padding: 16px;
          gap: 16px;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="logo"><i class="fas fa-paper-plane"></i> LinkVerse</div>
      <div class="search-container">
        <input
          type="text"
          id="searchInput"
          placeholder="Tìm kiếm gì đó vui vẻ..."
          class="bordered-element"
        />
      </div>
    </header>

    <main>
      <aside class="sidebar">
        <div class="sidebar-content bordered-element">
          <h2><i class="fas fa-compass"></i> Thư Mục</h2>
          <ul id="folderList" style="margin-top: 1rem"></ul>
          <button
            id="addFolderBtn"
            class="action-button bordered-element"
            style="margin-top: 20px"
          >
            <i class="fas fa-folder-plus"></i> Thêm Mới
          </button>
        </div>
      </aside>

      <div class="link-management">
        <button
          id="toggleAddLinkForm"
          class="action-button bordered-element"
          style="margin-bottom: 24px"
        >
          <i class="fas fa-plus-circle"></i> Thêm Link Mới
        </button>

        <section
          id="addLinkFormContainer"
          class="bordered-element"
          style="display: none"
        >
          <h2 style="margin-bottom: 1rem">Thêm Link Mới Nè!</h2>
          <div
            class="add-link-form"
            style="display: flex; flex-direction: column; gap: 1rem"
          >
            <input
              type="text"
              id="linkTitle"
              placeholder="Tên gọi của link..."
              class="bordered-element"
            />
            <input
              type="url"
              id="linkUrl"
              placeholder="Dán link vào đây..."
              class="bordered-element"
            />
            <select id="linkFolder" class="bordered-element"></select>
            <button
              id="addLinkBtn"
              class="action-button bordered-element"
              style="background-color: var(--accent-teal)"
            >
              <i class="fas fa-rocket"></i> Phóng!
            </button>
          </div>
        </section>

        <section class="link-list-container bordered-element">
          <h2 style="margin-bottom: 1rem">Bộ Sưu Tập Link</h2>
          <div
            class="controls-row"
            style="
              display: flex;
              gap: 1rem;
              margin-bottom: 24px;
              align-items: center;
            "
          >
            <select id="sortBy" class="bordered-element" style="flex-grow: 1">
              <option value="dateAdded">Mới nhất</option>
              <option value="titleAsc">Tên (A-Z)</option>
              <option value="titleDesc">Tên (Z-A)</option>
            </select>
            <input
              type="text"
              id="filterByTag"
              placeholder="Lọc theo tag..."
              class="bordered-element"
              style="flex-grow: 2"
            />
          </div>
          <div id="linkList" class="link-grid"></div>
        </section>
      </div>
    </main>

    <div id="modal" class="modal">
      <div id="modalContent" class="modal-content bordered-element">
        <h3 id="modalTitle" style="margin-bottom: 1rem"></h3>
        <div id="modalMessage" style="margin-bottom: 1.5rem"></div>
        <div id="modalInput" style="display: none; margin-bottom: 1.5rem">
          <input
            type="text"
            id="modalTextInput"
            class="bordered-element"
            placeholder="Nhập ở đây..."
          />
        </div>
        <div
          class="modal-actions"
          style="display: flex; justify-content: flex-end; gap: 1rem"
        >
          <button id="modalCancel" style="display: none"></button>
          <button id="modalConfirm" style="display: none"></button>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const linkTitleInput = document.getElementById("linkTitle");
        const linkUrlInput = document.getElementById("linkUrl");
        const linkFolderSelect = document.getElementById("linkFolder");
        const addLinkBtn = document.getElementById("addLinkBtn");
        const linkListDiv = document.getElementById("linkList");
        const addFolderBtn = document.getElementById("addFolderBtn");
        const folderListUl = document.getElementById("folderList");
        const searchInput = document.getElementById("searchInput");
        const sortBySelect = document.getElementById("sortBy");
        const filterByTagInput = document.getElementById("filterByTag");
        const addLinkFormContainer = document.getElementById(
          "addLinkFormContainer"
        );
        const toggleAddLinkFormBtn =
          document.getElementById("toggleAddLinkForm");
        const modal = document.getElementById("modal");
        const modalTitle = document.getElementById("modalTitle");
        const modalMessage = document.getElementById("modalMessage");
        const modalInput = document.getElementById("modalInput");
        const modalTextInput = document.getElementById("modalTextInput");
        const modalConfirmBtn = document.getElementById("modalConfirm");
        const modalCancelBtn = document.getElementById("modalCancel");

        let links = JSON.parse(localStorage.getItem("links")) || [];
        let folders = JSON.parse(localStorage.getItem("folders")) || [
          "Công việc",
          "Học tập",
          "Giải trí",
        ];
        let activeFolder = "all";

        toggleAddLinkFormBtn.addEventListener("click", () => {
          const isHidden = addLinkFormContainer.style.display === "none";
          addLinkFormContainer.style.display = isHidden ? "block" : "none";
          if (isHidden) linkTitleInput.focus();
        });

        function showModal(
          title,
          message = "",
          {
            showInput = false,
            confirmText = "OK",
            cancelText = "Hủy",
            placeholder = "Nhập giá trị...",
            defaultValue = "",
          } = {}
        ) {
          return new Promise((resolve) => {
            modalTitle.textContent = title;
            modalMessage.innerHTML = message;
            modalConfirmBtn.textContent = confirmText;
            modalCancelBtn.textContent = cancelText;

            if (title.includes("Xóa")) {
              modalConfirmBtn.style.backgroundColor = "var(--accent-red)";
            } else {
              modalConfirmBtn.style.backgroundColor = "var(--accent-teal)";
            }

            modalConfirmBtn.style.display = "inline-block";
            modalCancelBtn.style.display = "inline-block";
            modalInput.style.display = showInput ? "block" : "none";
            if (showInput) {
              modalTextInput.placeholder = placeholder;
              modalTextInput.value = defaultValue;
              setTimeout(() => modalTextInput.focus(), 50);
            }
            modal.classList.add("active");

            const cleanup = () => {
              modalConfirmBtn.removeEventListener("click", onConfirm);
              modalCancelBtn.removeEventListener("click", onCancel);
              window.removeEventListener("click", onOutsideClick);
            };

            const onConfirm = () => {
              hideModal();
              resolve(showInput ? modalTextInput.value.trim() : true);
              cleanup();
            };
            const onCancel = () => {
              hideModal();
              resolve(null);
              cleanup();
            };
            const onOutsideClick = (event) => {
              if (event.target === modal) onCancel();
            };

            modalConfirmBtn.addEventListener("click", onConfirm, {
              once: true,
            });
            modalCancelBtn.addEventListener("click", onCancel, { once: true });
            window.addEventListener("click", onOutsideClick);
          });
        }

        function hideModal() {
          modal.classList.remove("active");
        }
        function saveLinks() {
          localStorage.setItem("links", JSON.stringify(links));
        }
        function saveFolders() {
          localStorage.setItem("folders", JSON.stringify(folders));
        }

        function renderFolders() {
          folderListUl.innerHTML = "";

          // Render "All Links" folder
          const allLinksLi = document.createElement("li");
          allLinksLi.dataset.folder = "all";
          allLinksLi.innerHTML = `<span><i class="fas fa-folder-open"></i> Tất Cả Link</span>`;
          if (activeFolder === "all") allLinksLi.classList.add("active");
          folderListUl.appendChild(allLinksLi);

          // Render other folders
          folders.forEach((folder) => {
            const li = document.createElement("li");
            li.dataset.folder = folder;
            li.innerHTML = `
              <span class="folder-name"><i class="fas fa-folder"></i> ${folder}</span>
              <button class="delete-folder-btn" data-folder="${folder}" title="Xóa thư mục"><i class="fas fa-trash-alt"></i></button>
            `;
            if (activeFolder === folder) li.classList.add("active");
            folderListUl.appendChild(li);
          });

          linkFolderSelect.innerHTML = folders
            .map((f) => `<option value="${f}">${f}</option>`)
            .join("");

          // Add event listeners
          document.querySelectorAll("#folderList li").forEach((item) => {
            // Click on folder name to select
            const folderNameSpan = item.querySelector(".folder-name, span");
            if (folderNameSpan) {
              folderNameSpan.addEventListener("click", () => {
                activeFolder = item.dataset.folder;
                renderFolders();
                renderLinks();
              });
            }

            // Click on delete button
            const deleteBtn = item.querySelector(".delete-folder-btn");
            if (deleteBtn) {
              deleteBtn.addEventListener("click", (e) => {
                e.stopPropagation(); // Prevent folder selection
                deleteFolder(deleteBtn.dataset.folder);
              });
            }
          });
        }

        async function addFolder() {
          const newFolderName = await showModal("Thêm Thư Mục Mới", "", {
            showInput: true,
            placeholder: "Tên thư mục...",
          });
          if (
            newFolderName &&
            !folders.find(
              (f) => f.toLowerCase() === newFolderName.toLowerCase()
            )
          ) {
            folders.push(newFolderName);
            saveFolders();
            renderFolders();
          } else if (newFolderName) {
            await showModal("Lỗi", "Thư mục này đã tồn tại rồi!");
          }
        }

        async function deleteFolder(folderName) {
          if (folders.length <= 1) {
            await showModal("Không thể xóa", "Cần có ít nhất một thư mục.");
            return;
          }
          const confirmed = await showModal(
            "Xác Nhận Xóa",
            `Bạn có chắc muốn xóa thư mục "<b>${folderName}</b>"? Các link bên trong sẽ được chuyển sang thư mục khác.`,
            { confirmText: "Xóa" }
          );
          if (confirmed) {
            const fallbackFolder = folders.find((f) => f !== folderName);
            links.forEach((link) => {
              if (link.folder === folderName) link.folder = fallbackFolder;
            });
            folders = folders.filter((f) => f !== folderName);
            if (activeFolder === folderName) activeFolder = "all";
            saveLinks();
            saveFolders();
            renderFolders();
            renderLinks();
          }
        }

        async function addLink() {
          const title = linkTitleInput.value.trim();
          let url = linkUrlInput.value.trim();
          const folder = linkFolderSelect.value;
          if (!title || !url || !folder) {
            await showModal("Thiếu rồi!", "Vui lòng điền đủ thông tin nha.");
            return;
          }
          if (!url.startsWith("http")) url = "https://" + url;
          links.unshift({
            id: Date.now(),
            title,
            url,
            folder,
            dateAdded: new Date().toISOString(),
            tags: [],
          });
          saveLinks();
          renderLinks();
          linkTitleInput.value = "";
          linkUrlInput.value = "";
          addLinkFormContainer.style.display = "none";
        }

        function renderLinks() {
          let currentLinks = [...links];
          if (activeFolder !== "all")
            currentLinks = currentLinks.filter(
              (link) => link.folder === activeFolder
            );

          const searchTerm = searchInput.value.toLowerCase();
          if (searchTerm)
            currentLinks = currentLinks.filter(
              (l) =>
                l.title.toLowerCase().includes(searchTerm) ||
                l.url.toLowerCase().includes(searchTerm)
            );

          const tagTerm = filterByTagInput.value.toLowerCase();
          if (tagTerm)
            currentLinks = currentLinks.filter(
              (l) =>
                l.tags && l.tags.some((t) => t.toLowerCase().includes(tagTerm))
            );

          const sortBy = sortBySelect.value;
          currentLinks.sort((a, b) => {
            if (sortBy === "titleAsc") return a.title.localeCompare(b.title);
            if (sortBy === "titleDesc") return b.title.localeCompare(a.title);
            return new Date(b.dateAdded) - new Date(a.dateAdded);
          });

          linkListDiv.innerHTML = currentLinks
            .map(
              (link) => `
            <div class="link-card bordered-element" data-id="${link.id}">
                <h3>${link.title}</h3>
                <a href="${
                  link.url
                }" target="_blank" rel="noopener noreferrer" style="color:var(--accent-teal); word-break:break-all; margin: 0.5rem 0 1rem 0; display:block;">${
                link.url
              }</a>
                <div class="tags" style="display:flex; flex-wrap:wrap; gap:0.5rem; margin-top:auto; padding-top:1rem;">
                    ${(link.tags || [])
                      .map((tag) => `<span class="tag">${tag}</span>`)
                      .join("")}
                </div>
                <div class="actions" style="display:flex; justify-content:flex-end; gap:1rem; padding-top:1rem; border-top: 2px solid var(--outline-color); margin-top:1rem;">
                    <button class="edit-btn" title="Sửa"><i class="fas fa-pen"></i></button>
                    <button class="tag-btn" title="Gắn Tag"><i class="fas fa-tags"></i></button>
                    <button class="delete-btn" title="Xóa"><i class="fas fa-trash-alt"></i></button>
                </div>
            </div>`
            )
            .join("");

          if (currentLinks.length === 0) {
            linkListDiv.innerHTML =
              '<div style="text-align:center; color: var(--text-light); padding: 40px; grid-column: 1 / -1;"><i class="fas fa-ghost fa-3x"></i><p style="margin-top:1rem; font-size:1.2rem;">Hổng có link nào hết!</p></div>';
          }
        }

        linkListDiv.addEventListener("click", (e) => {
          const button = e.target.closest("button");
          if (!button) return;
          const card = e.target.closest(".link-card");
          const id = Number(card.dataset.id);
          if (button.classList.contains("delete-btn")) deleteLink(id);
          if (button.classList.contains("edit-btn")) editLink(id);
          if (button.classList.contains("tag-btn")) manageTags(id);
        });

        async function deleteLink(id) {
          const confirmed = await showModal(
            "Xác Nhận Xóa",
            "Bạn có chắc muốn vứt link này đi không?",
            { confirmText: "Vứt!" }
          );
          if (confirmed) {
            links = links.filter((l) => l.id !== id);
            saveLinks();
            renderLinks();
          }
        }

        async function editLink(id) {
          const link = links.find((l) => l.id === id);
          const modalHTML = `<div style="display:flex; flex-direction:column; gap:1rem;">
                <input type="text" id="editTitle" class="bordered-element" value="${
                  link.title
                }">
                <input type="url" id="editUrl" class="bordered-element" value="${
                  link.url
                }">
                <select id="editFolder" class="bordered-element">${folders
                  .map(
                    (f) =>
                      `<option value="${f}" ${
                        f === link.folder ? "selected" : ""
                      }>${f}</option>`
                  )
                  .join("")}</select>
            </div>`;
          const confirmed = await showModal("Chỉnh Sửa Link", modalHTML, {
            confirmText: "Lưu",
          });
          if (confirmed) {
            link.title = document.getElementById("editTitle").value;
            link.url = document.getElementById("editUrl").value;
            link.folder = document.getElementById("editFolder").value;
            saveLinks();
            renderLinks();
          }
        }

        async function manageTags(id) {
          const link = links.find((l) => l.id === id);
          const newTags = await showModal(
            "Gắn Vài Cái Tag",
            `Nhập các tag, cách nhau bởi dấu phẩy.`,
            { showInput: true, defaultValue: (link.tags || []).join(", ") }
          );
          if (newTags !== null) {
            link.tags = newTags
              .split(",")
              .map((t) => t.trim())
              .filter(Boolean);
            saveLinks();
            renderLinks();
          }
        }

        addLinkBtn.addEventListener("click", addLink);
        addFolderBtn.addEventListener("click", addFolder);
        searchInput.addEventListener("input", renderLinks);
        sortBySelect.addEventListener("change", renderLinks);
        filterByTagInput.addEventListener("input", renderLinks);
        renderFolders();
        renderLinks();
      });
    </script>
  </body>
</html>
